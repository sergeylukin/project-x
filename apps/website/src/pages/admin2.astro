---
import { app } from '@astro-nx-depla/website/app';
import { BaseLayout as Layout } from '@astro-nx-depla/shared/ui';
---

<Layout>
    <script
      is:inline
      src="https://identity.netlify.com/v1/netlify-identity-widget.js"
    ></script>
    <script is:inline>
      window.CMS_MANUAL_INIT = true;
    </script>
    <script is:inline src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
<script is:inline define:vars={{ isProd: app.isProd }}>
      const { CMS, initCMS: init } = window;
      console.log(CMS, init);
      /* CMS.registerWidget('mdx', MdxControl, MdxPreview); */

      /* CMS.init(); */
      if (isProd) {
        console.log('Hey I am currently in production')
      }else {
        console.log('Hey I am currently NOT in production')
      }
      init({
        config: {
          backend: (isProd ? {
            name: 'git-gateway',
            branch: 'main',
          } : {
            name: 'proxy',
            proxy_url: 'http://localhost:8081/api/v1git-gateway',
            branch: 'main',
          }),
          local_backend: isProd ? false : true,
          load_config_file: false,
          media_folder: 'apps/website/src/assets/images',
          public_folder: '~/assets/images',
          publish_mode: 'editorial_workflow',
          collections: [
            {
              label: isProd ? 'Posts' : 'Shmosts',
              name: 'post',
              folder: 'apps/website/src/content/post',
              create: true,
              delete: true,
              extension: 'mdx',
              format: 'frontmatter',
              fields: [
                { name: 'title', widget: 'string', label: 'Post Title' },
                { name: 'image', widget: 'image', label: 'Cover' },
                { name: 'body', widget: 'markdown', label: 'Post Body' },
                { label: 'Description', name: 'description', widget: 'text' },
                { label: 'Tags', name: 'tags', widget: 'list' },
                { label: 'Author', name: 'author', widget: 'string' },
                {
                  label: 'Author Twitter Handle',
                  name: 'authorTwitter',
                  widget: 'string',
                },
                { label: 'Publish Date', name: 'date', widget: 'datetime' },
              ],
            },
          ],
        },
      });
    </script>
</Layout>
